$(function(){toastr.options={closeButton:!0,debug:!1,positionClass:"toast-bottom-left",onclick:null,showDuration:"0",hideDuration:"0",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"show",hideMethod:"fadeOut",tapToDismiss:!1};$(".dataTables-example").DataTable({pageLength:25,responsive:!0,dom:'<"html5buttons"B>lTfgitp',buttons:[],columnDefs:[{targets:"no-sort",orderable:!1}],fnDrawCallback:function(e){$("[data-toggle='confirmation']").confirmation({singleton:!0,popout:!0})}});$("#pp-selector").on("change",function(e){window.location.href=$(e.target).val()}),$("[data-toggle=confirmation]").confirmation({rootSelector:"[data-toggle=confirmation]"}),$("#details_btn").on("click",function(e){e.preventDefault();var t=$(this).data("request_id"),o=$(this).data("hreff");console.log(t),$.ajax({type:"GET",data:{},url:o,success:function(e){$("#device_details_parent_"+t).html(e)},error:function(e){if(401==e.status||404==e.status)window.location=e.getResponseHeader("Location");else{var t=$.parseJSON(e.responseText),o="";$.each(t,function(e,t){o+=t}),toastr.error("",o)}}})}),$("body").on("confirmed.bs.confirmation",".delete-ajax",function(e){e.preventDefault();var t=$(this).data("hreff"),o=$(this).data("token"),a=$(this).data("id"),n=($(this),$(this).data("to_generate")),s=$(this).data("do-not-reload");$.ajax({type:"POST",data:{_method:"delete",_token:o,id:a},url:t,success:function(e){e.msg==device_assigned?swal({title:device_assigned,text:device_assigned,type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!1,allowEscapeKey:!0,closeOnCancel:!1},function(t){t?$.ajax({type:"POST",url:e.route,data:{_method:"delete",_token:e.token,id:a},success:function(e){toastr.success("",e),setTimeout(function(){location.reload(1)},2e3)},error:function(e){swal(cancelled,e,"error")}}):swal(cancelled,cancelledText,"error")}):e.msg==device_move_notify?swal({title:device_move_notify,text:device_move_notify,type:"warning",showCancelButton:!1,closeOnConfirm:!1,showLoaderOnConfirm:!1,allowEscapeKey:!0,closeOnCancel:!1},function(t){t?$.ajax({type:"POST",url:e.route,data:{_method:"delete",_token:e.token,id:a},success:function(e){toastr.success("",e),setTimeout(function(){location.reload(1)},2e3)},error:function(e){swal(cancelled,e,"error")}}):swal(cancelled,cancelledText,"error")}):(n?toastr.success("",e):($("#toRemove-"+a).remove(),"Activated"==e?toastr.success("",e):"Activation Code Generated"==e?toastr.success("",e):toastr.error("",e)),"yes"==s||setTimeout(function(){location.reload(1)},2e3))},error:function(e){if(401==e.status||404==e.status)window.location=e.getResponseHeader("Location");else{var t=$.parseJSON(e.responseText),o="";$.each(t,function(e,t){o+=t}),toastr.error("",o)}}})}),$("body").on("confirmed.bs.confirmation",".post-ajax",function(e){e.preventDefault();var t=$(this).data("hreff"),o=$(this).data("token"),a=$(this).data("id"),n=$(this).data("do-not-reload");$.ajax({type:"POST",data:{_token:o,id:a},url:t,success:function(e){toastr.success("",e),"yes"!==n&&setTimeout(function(){location.reload(1)},2e3)},error:function(e){401===e.status||404===e.status?window.location=e.getResponseHeader("Location"):toastr.error("",e.responseText)}})}),$("#modal-form").on("show.bs.modal",function(e){var t=$(e.relatedTarget).data("href");$.ajax({type:"get",data:{},url:t,success:function(e){$("#modal-form .modal-content").html(e),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green"}),$("#address").length&&window.addressHandler($("#address"),$("#city"),$("#zip_code"),$("#country"),$("#latitude"),$("#longitude")),$("#select_customer_type").on("change",function(e){var t=$("#select_customer_type").val(),o=$("#select_customer").data("trans-placeholder");$("#otherDist").on("ifChecked",function(e){$("#select_customer").find("option").remove().end().append($("<option>",{value:"0",text:o,address:""})).attr("disabled","disabled").trigger("chosen:updated");var t=$(this).data("url"),a=$(this).data("token"),n=$(this).data("id");$.ajax({type:"POST",url:t,data:{_token:a,id:n,others:"yes"},success:function(e){$.each(e,function(t,o){$("#select_customer").append($("<option>",{value:e[t].id,text:e[t].company,address:e[t].address}))})},error:function(e){alert("Connection error")},complete:function(){$("#select_customer").removeAttr("disabled").trigger("chosen:updated")}})}),$("#otherDist").on("ifUnchecked",function(e){$("#select_customer").find("option").remove().end().append($("<option>",{value:"0",text:o,address:""})).attr("disabled","disabled").trigger("chosen:updated");var t=$(this).data("url"),a=$(this).data("token"),n=$(this).data("id");$.ajax({type:"POST",url:t,data:{_token:a,id:n,others:"no"},success:function(e){$.each(e,function(t,o){$("#select_customer").append($("<option>",{value:e[t].id,text:e[t].company,address:e[t].address}))})},error:function(e){alert("Connection error")},complete:function(){$("#select_customer").removeAttr("disabled").trigger("chosen:updated")}})}),1==t?($("#keep_data").hide(),$("#customerExisting").hide(),$("#customerRegister").show(),$("#overwrite_warranty").show()):2==t?($("#keep_data").hide(),$("#customerRegister").hide(),$("#customerExisting").show(),$("#overwrite_warranty").show()):3==t?($("#keep_data").show(),$("#customerRegister").hide(),$("#customerExisting").hide(),$("#overwrite_warranty").hide(),console.log($("#keep_data").val())):($("#keep_data").hide(),$("#customerRegister").hide())}),$("#formMove").on("submit",function(e){e.preventDefault();var t=$("[type='submit']").button("loading"),o=$("#select_customer_type").val(),a=($("#keep_data:checked").val(),$("#overwrite_warranty:checked").val()),n=$("#oldCustomer").val(),s=$("option:selected","#select_customer").text(),r=$("option:selected","#select_customer").attr("address"),i=$(this).attr("action"),c=$("#select_customer").val(),d=$("[name='_token']").val();2==o?0==c?(toastr.error("",select_new_customer_validation),t.button("reset")):swal({title:confirmMoveTitle,text:"<div class='row'><div class='row'><div class='col-xs-12'>"+confirmFirstLine+" <strong> "+n+"</strong><br/></div></div><div class='row'><div class='col-xs-12'>"+confirmSecondLine+" <strong>< "+s+" , "+r+" ></strong><br/></div></div></div>",type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,allowEscapeKey:!0,html:!0,closeOnCancel:!1},function(e){e?$.ajax({type:"POST",url:i,data:{_token:d,customerType:o,customer:c,overwrite_warranty_new:a},success:function(e){toastr.success("",e),setTimeout(function(){location.reload(1)},1e3)},error:function(e){swal.close(),401!=e.status&&404!=e.status||(window.location=e.getResponseHeader("Location")),$("#modal-form .modal-content .form-body .alert-danger").fadeOut(500);var o=$.parseJSON(e.responseText),a='<div class="alert alert-block alert-danger fade in"><button type="button" class="close" data-dismiss="alert"></button> <p>';$.each(o,function(e,t){a+=t+"</p>"}),$("#modal-form .modal-content .form-body").prepend(a+"</div>"),t.button("reset")}}):(swal(cancelled,cancelledText,"error"),$("#modal-form").modal("toggle"))}):$.ajax({type:"POST",url:$(this).attr("action"),data:new FormData(this),processData:!1,contentType:!1,success:function(e){toastr.success("",e),setTimeout(function(){location.reload(1)},2e3)},error:function(e){401!=e.status&&404!=e.status||(window.location=e.getResponseHeader("Location")),$("#modal-form .modal-content .form-body .alert-danger").fadeOut(500);var o=$.parseJSON(e.responseText),a='<div class="alert alert-block alert-danger fade in"><button type="button" class="close" data-dismiss="alert"></button> <p>';$.each(o,function(e,t){a+=t+"</p>"}),$("#modal-form .modal-content .form-body").prepend(a+"</div>"),t.button("reset")}})}),$("#formTested").on("submit",function(e){e.preventDefault();var t=$("[type='submit']").button("loading");$.ajax({type:"POST",url:$(this).attr("action"),data:new FormData(this),processData:!1,contentType:!1,success:function(e){$("#modal-form").modal("toggle"),swal({title:checkAlertFirstLine,text:checkAlertSecondLine,type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!1,allowEscapeKey:!0,closeOnCancel:!1},function(t){t?swal({title:checkAlertFirstLineSecondLevel,text:"<div class='row'><div class=\"alert alert-danger\"><div class='row'><div class='col-xs-5'>"+existingSerial+"</div><div class='col-xs-7'><strong> "+e.old_serial+"</strong><br/></div><div class='col-xs-5'>"+newSerial+"</div><div class='col-xs-7'><strong> "+e.serial+"</strong><br/></div><div class='col-xs-5'>"+oldType+"</div><div class='col-xs-7'><strong> "+e.old_device_type+"</strong><br/></div><div class='col-xs-5'>"+newType+"</div><div class='col-xs-7'><strong> "+e.device_type+"</strong><br/></div></div></div></div>",type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,allowEscapeKey:!0,html:!0,closeOnCancel:!1},function(t){t?$.ajax({type:"POST",url:updateSecondLevel,data:{_token:e._token,id:e.id,serial:e.serial,old_serial:e.old_serial},success:function(e){setTimeout(function(){swal({title:e,text:e},function(){setTimeout(function(){location.reload(1)},1e3)})},1e3)},error:function(e){swal(cancelled,e,"error")}}):swal(cancelled,cancelledText,"error")}):swal(cancelled,cancelledText,"error")})},error:function(e){401!=e.status&&404!=e.status||(window.location=e.getResponseHeader("Location")),$("#modal-form .modal-content .form-body .alert-danger").fadeOut(500);var o=$.parseJSON(e.responseText),a='<div class="alert alert-block alert-danger fade in"><button type="button" class="close" data-dismiss="alert"></button> <p>';$.each(o,function(e,t){a+=t+"</p>"}),$("#modal-form .modal-content .form-body").prepend(a+"</div>"),t.button("reset")}})}),$("#formTest").on("submit",function(e){var t=$("[type='submit']").button("loading"),o=$(this).data("do-not-reload");e.preventDefault(),$.ajax({type:"POST",url:$(this).attr("action"),data:new FormData(this),processData:!1,contentType:!1,success:function(e){"yes"===o?toastr.options.onHidden=function(){location.reload(1)}:setTimeout(function(){location.reload(1)},2e3),toastr.success("",e)},error:function(e){401!=e.status&&404!=e.status||(window.location=e.getResponseHeader("Location")),$("#modal-form .modal-content .form-body .alert-danger").fadeOut(500);var o=$.parseJSON(e.responseText),a='<div class="alert alert-block alert-danger fade in"><button type="button" class="close" data-dismiss="alert"></button> <p>';$.each(o,function(e,t){a+=t+"</p>"}),$("#modal-form .modal-content .form-body").prepend(a+"</div>"),t.button("reset")}})})},error:function(e){401!==e.status&&404!==e.status||(window.location=e.getResponseHeader("Location"))}})}),$('[data-tooltip="tooltip"]').tooltip(),$(document).on("click","button.toggle-modal-code-generation-content",function(e){var t=$(e.target).parents("#modal-form");$(t).find(".modal-header, .modal-body, .modal-footer").toggleClass("hidden"),$(t).find("fieldset").each(function(e,t){$(t).prop({disabled:!$(t).is(":disabled")})})}).on("change","input.guarantee-agreed",function(e){$(e.target).parents("#modal-form").find("button.continue").prop({disabled:!$(e.target).is(":checked")})})});